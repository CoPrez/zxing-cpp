<html>
<head>
<title>ZXing in Javascript demo</title>
<script src="zxing_writer.js"></script>
<script src="base64.js"></script>
</head>
<body>
<div id="write_result"></div>
<script>

    var zxing = null;
    
    function generateBarcode() {
        const urlParams = new URLSearchParams(window.location.search);
    
        var text = urlParams.get("text");
        var format = urlParams.get("format");
        var charset = urlParams.get("charset") ?? "UTF-8";
        var margin = parseInt(urlParams.get("margin") ?? 0);
        var width = parseInt(urlParams.get("width") ?? Math.min(document.body.clientWidth, 1024));
        var height = parseInt(urlParams.get("height") ?? Math.min(document.body.clientHeight, 1024));
        var eccLevel = parseInt(urlParams.get("ecclevel") ?? -1);
        
        var result;
        if (zxing != null) {
            result = zxing.generateBarcode(text, format, charset, margin, width, height, eccLevel);
        } else {
            result = { error: "ZXing not yet initialized" };
        }
        if (result.image) {
            showImage(document.getElementById("write_result"), result.image);
            result.delete();
        }
        else {
            var container = document.getElementById("write_result");
            container.innerHTML = '<font color="red">Error: ' + result.error + '</font>';
            container.style.width = '200px';
        }
    }
    
    function showImage(container, fileData) {
        container.innerHTML = "";
        var img = document.createElement("img");
        img.addEventListener('load', function() {
            container.style.width = img.width + 'px';
            container.style.height = img.height + 'px';
        });
        img.src = "data:image/png;base64," + uint8ArrayToBase64(fileData);
        container.appendChild(img);
    }

    ZXing().then(function(value) {
        zxing = value;
        generateBarcode();
    });
    </script>
</body>
</html>